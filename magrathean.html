
<!--
magrathean.html
An exercise for learning Meteor (see meteor.com for explanation of Meteor).
See magrathean.md for full explanation.
sjhalasz@gmail.com

This is a Meteor html file. 
The following is ordinary HTML but with references to Meteor templates e.g.
     {{> a_template_name }}.  The templates themselves are defined at the 
	 bottom of the file.
-->

<body>
<!-- A container is recommended for Meteor -->
  <div class="container">
    
    <h2>Add/Change/Delete Controls</h2>
    
    Add controls by:
    <ul>
      <li>entering a name for the data element (e.g. firstname),</li> 
      <li>then selecting a type, </li>
      <li>then entering a label (e.g. First Name), </li>
      <li>then, for select type only, enter a list of options separated by commas (e.g. Detroit,Cleveland,Miami,Sarasota).</li>
    </ul>
    Change controls by defining the same name with different parameters<br><br>
    Delete controls by clicking on the X button next to the control.<br><br>
    <!-- Form for adding a new control -->
    <form class="controlUpdate">
      <!-- Input for the name of the control  -->
      <input type="text" name="name" placeholder="Name of the control..." />
      <!-- Select for the type of the control  -->
      <select name="type">
        <option value="text">text</option> <!-- Just text that's displayed, 
		                                        not really a control -->
        <option value="input">input</option> <!-- A text input control  -->
        <option value="select">select</option> <!-- A select control -->
        <option value="date">date</option> <!-- A JQuery UI datepicker control  -->
      </select>
      <!-- Input for the label for the control  -->
      <input type="text" name="label" placeholder="Label..." />
      <!-- Input for the options if this is a select control, comma separated text  -->
      <input type="text" name="options" placeholder="Options for select..." />
      <!-- Button to add a control, or, if the name used is the same as an existing control, to change it   -->
      <input type="submit" value="Add/Change Control">
    </form>
    
    <h2>Add/Change/Navigate Records</h2>

    <!-- Form to navigate through data records  -->
   <form class="recordNavigate">
     The Back and Next buttons move through records already saved for the form below. The New button is for entering a new record.<br>
     <button class="recordNew">New</button> <!-- Button to navigate to a new record  -->
     <button class="recordBack">Back</button> <!-- Button to navigate to previous record   -->
     <button class="recordNext">Next</button> <!-- Button to navigate to next record  -->
     <!-- A Meteor template reference which simply displays the record number -->
     {{> recordId}}
   </form>
   
   <!-- Form to enter data for a record -->
   <form class="recordUpdate">
      After entering or changing the values of the controls below, click the Add/Change Record
	  button to save the changes for the record.<br>
     <!-- A button to submit the new or changed record  -->
      <input type="submit" value="Add/Change Record"><br>
      <!-- A Meteor template reference to add the soft controls that were defined
           using the hard controls above
      -->
      {{> controls}}
   </form>
  </div>
</body>

<!-- Below are the Meteor templates referenced above -->
<!-- Template to display the current record number -->
<template name="recordId">
<!-- Calls a helper function named index that returns the record number -->
  Record number {{recordId}}
</template>

<!-- Template to create the controls  -->
<template name="controls">
      <!-- For each document in cursor returned by helper function named controls...  -->
      {{#each controls}}
        <!-- Add a button to delete this control  -->
        <button class="controlDelete">&times;</button>
        <!-- For all controls, reference template named label to display the label -->
        {{> label}}
        <!-- for text type control, the label is all that's created -->
        <!-- Call helper function equals which returns true if typ == 'input'  -->
        {{#if equals 'input' type}}
          <!-- Reference template named input to create input control  -->
          {{> input}}
        {{else}}
          <!-- Call helper function equals which returns true if typ == 'select'  -->
          {{#if equals 'select' type}}
            <!-- Reference template named select to create select control  -->
            {{> select}}
          {{else}}
            <!-- Call helper function equals which returns true if typ == 'date'  -->
            {{#if equals 'date' type}}
              <!-- Reference template named date to create date control  -->
              {{> date}}
            {{else}} 
              <!-- For everything else, just leave it at label, e.g. text  -->
            {{/if}}
          {{/if}}
        {{/if}}
        <br> <!-- new line after each soft control -->
      {{/each}}
</template>

<!-- Template to display control label -->
<template name="label">
  <!-- lab is label for the soft control; nam and typ are control name and type -->
  {{label}} ({{name}};{{type}}) <!-- just display this -->
</template>

<!-- Template to create text input control -->
<template name="input">
  <!-- Define input control with name equal to nam property from document-->
  <input 
    name="{{name}}"
    {{! Set the value of control by calling global helper function data;
         data function takes 3 arguments but only the first is used here
	     (you can't omit trailing arguments with Meteor like you can with usual JS);
		 data function references the current record number to return data for
		 the current record for the control named nam.
	}}
    value="{{data name 0 0}}"
  >
</template>

<!-- Template to create a select control -->
<template name="select">
<!-- Define the select control with name = nam -->
  <select 
    name="{{name}}"
  >
    <!-- For each option...
     	 (helper function commaSplit splits document property opt on commas
		   and returns an array of strings)
    -->
    {{#each commaSplit options}}
      <!-- Option value and text are identical here and are in {{this}} 
           when using #each on array of strings
      -->
      <option value="{{this}}"
        {{! Call helper function data with three arguments;
             first argument is name of the control as usual but
             it needs to reference the nam property from the 
             outer #each loop, which requires use of ../ in front;
             when 3 arguments are supplied, it returns the 
             text in the 3rd argument if the 1st and 2nd
             are equal; so, this inserts 'selected' if this option
	         is equal to the data for this record for this control
	   }}
        {{data ../name this 'selected'}} 
      >
        {{! Insert the option text; it's the same as option value }}
        {{this}}
      </option>
    {{/each}}
  </select>
</template>

<!-- Template to create a date control -->
<template name="date">
{{! Define a text input control }}
  <input 
    {{! All date controls will have class datepicker }}
    class="datepicker" 
    name="{{name}}"
    {{! Call the helper function named data to get the value, as described earlier }}
    value="{{data name 0 0}}"
  >
</template>
